# **Climick**

<div align=center>

### _" Climbing + Click "_

🧗 마우스로 손발을 클릭해서 클라이밍을 할 수 있는 게임입니다.

https://climick.netlify.app

</div>

# Table of Contents

- [🔍 Preview](#-preview)
- [⚙️ Tech stack](#%EF%B8%8F-tech-stack)
- [💭 Motivation](#-motivation)
- [💻 Features](#-features)
- [💫 Challenges](#-challenges)
  - [1. 관절 움직임 표현](#1-관절-움직임-표현)
  - [2. 물리 엔진 구현](#2-물리-엔진-구현)
- [📅 Timeline](#-timeline)
- [📝 Memoir](#-memoir)
- [🎥 Video](#-video)

# 🔍 Preview

![start](https://user-images.githubusercontent.com/50537876/235917302-157283eb-eb80-4a66-9393-911b3f77b8ad.gif)

# ⚙️ Tech stack

### Frontend

- React
- React router
- Redux-toolkit
- Styled Components
- Pixi.js
- ESLint
- Jest

### Backend

- Node.js
- Express
- MongoDB Atlas / Mongoose
- ESLint

# 💭 Motivation

**클라이밍, 수학, 물리** - 제가 좋아하는 요소들을 모아서 아이디어를 기획했습니다.

단순히 특정 라이브러리 사용법을 아는 것을 떠나서, 모두가 배운 수학,물리 공식을 바탕으로 논리적으로 사고를 전개해나가는 과정을 보여주고 싶었습니다. 사람의 관절 움직임 및 물리엔진 구현이라는 생소한 문제에 도전해보고 싶었습니다.

클라이밍짐에 가지 않더라도 클라이밍 동작들을 연습할 수 있는 서비스가 있으면 좋겠다는 생각이 들었습니다.

# 💻 Features

\*홀드: 손발로 잡을 수 있는 벽에 붙어있는 돌 형태를 의미합니다.

- 사용자는 플레이어의 손/발/몸통을 드래그해서 이동할 수 있습니다.
- 하늘색 배경에 있는 모든 물체들은 잡거나 밟을 수 있는 홀드입니다.
- 무게중심의 x좌표가 양 발 사이에 없으면 한쪽 팔이 펴질 때까지 무게중심이 중력을 받아서 아래로 내려갑니다.
- 양손으로 TOP홀드를 잡으면 랭킹정보에 기록이 등록됩니다.

# 💫 Challenges

## 1. 관절 움직임 표현

### 1) 팔(다리)가 손(발) 움직임에 따라 접혀야 한다.

팔다리는 시작점 좌표와 x,y 변화량으로 그릴 수 있는 `Line`으로 나타냈습니다.

손과 어깨의 좌표는 항상 알 수 있습니다. 따라서 아래 그림에서 theta1과 theta2를 구할 수 있습니다.

<img width="720" alt="image" src="https://user-images.githubusercontent.com/50537876/234926144-d343c566-d7fe-4075-9279-4834806a6bb7.png">

팔의 전완과 상완의 길이는 같다 가정하고, 전완이 지면과 이루는 각 HEX (theta1 + theta2)를 구해서 팔꿈치(elbow) 좌표를 계산할 수 있습니다.

🔽 손 위치에 따라 팔이 자연스럽게 접히는 모습

![climb_one_arm_movement](https://user-images.githubusercontent.com/50537876/234890662-804eff9e-91fd-4595-992e-d616d4e817d2.gif)

### 2) 신체 부위가 전체적으로 자연스럽게 움직여야 한다.

클라이밍 동작은 여러 신체부위의 움직임이 복합적으로 이루어진 결과물입니다.<br>
(ex. 손을 뻗어 멀리 있는 물체를 잡는다 = 손을 드래그해서 팔 관절이 이동한다 + 몸통이 손 방향으로 이동하면서 다른 관절도 움직인다​)

처음에는 손을 위로 뻗고, 몸통 올리고, 손 뻗는 과정을 통해서 무게중심을 올리게 했습니다.
그런데 이 움직임은 부자연스러웠고, 사용자 입장에서 불편했습니다.

그래서 한 손을 뻗는 동작을 할 때,

1. 먼저 팔 관절을 움직이는 함수 `moveJoint`를 실행하고, <br>
   이 과정에서 손에서 어깨까지 거리가 제한된 팔 길이를 넘어선다면

2. 몸통을 움직이는 함수 `moveBodyTo`를 실행합니다.<br>
   `moveBodyTo`는 몸통의 위치를 바꾸고 함수 내부에서 `moveJointBody`함수를 실행해서 다른 팔다리 관절을 몸통의 위치에 따라 자연스럽게 움직이게 합니다.

## 2. 물리 엔진 구현

> **library 없이 구현하기** <br> 중력가속도에 의한 신체부위 등가속 원운동만 잘 표현하면 되기 때문에 3rd party library 없이 직접 구현할 수 있겠다는 생각이 들었습니다.

중력은 항상 작용하고 있는데, <u>특정 조건 하에서 중력이 다른 힘의 합력보다 크게 작용해서 플레이어가 아래로 이동</u>한다고 전제하고 로직을 구성했습니다.

### 중력이 다른 힘의 합력보다 크게 작용하는 경우

1. **드래그앤드롭 후 손(발) 하나가 홀드에서 떨어진다면**<br>
   팔(다리)는 어깨(고관절)을 회전축으로 해서 중력 작용 방향으로 등가속 원운동을 합니다.

   - 손이 홀드에서 떨어졌다는 것을 어떻게 알 수 있을까?<br>
     - ~~홀드 각각의 입장에서 pointerdown 이벤트 발생 이후 `canvas` 에서 pointerup 이벤트가 발생하면 중력 작용 함수를 실행한다.~~<br>
       ⇒ 항상 홀드 위에 손발이 있기 때문에, 홀드는 pointerdown 이벤트를 감지할 수 없다.
     - 홀드 위치 기반으로 감지한다.<br>
       손/발에서 pointerup 이벤트가 발생할 때, 손/발이 정해진 홀드 좌표 내에 위치하지 않으면 중력 작용 함수를 실행한다. (어깨/고관절 좌표를 회전축으로 등가속 원운동을 한다.)
   - 등가속 원운동을 어떻게 표현할까?
     - 전완 및 상완의 회전 각도를 일정한 가속도로 증가시킨다.
     - `requestAnimationFrame()`으로 움직이는 모습을 부드럽게 나타낸다.

2. **양 손이 홀드에서 떨어진다면**<br>
   몸 전체가 아래 방향으로 등가속 운동을 합니다.

3. **무게중심의 x좌표가 양 발 사이에 없으면**<br>
   한쪽 팔이 펴질 때까지 무게중심이 중력을 받아서 아래로 내려갑니다.
   - 홀드 위치 안에 있는 왼손/오른손의 개수를 변수로 저장한다.
     - 각각 초기값은 1개이며, `onDragEnd` 함수를 실행할 때마다 손이 홀드 위치에 있는지 판별해서 변수값을 변경한다.
   - `onDragEnd` 함수 실행 시 손의 개수가 몇개인지 확인하고 0개라면 `fallDown` 함수를 실행해서 플레이어 컨테이너 자체를 아래 방향으로 등가속 운동시킨다.

# 📅 Timeline

### 프로젝트 기간: 2023.04.03(월) ~ 2023.04.28(금)

- 1 주차: 기획 및 설계
- 2~3 주차: 기능 개발
- 4주차: 테스트코드 작성, 발표

# 📝 Memoir

# 🎥 Video

썸네일을 클릭하면 게임 시연 유튜브 링크로 이동합니다.

🔽 첫번째 루트

[![Video Label](http://img.youtube.com/vi/w5qo4VSKXTo/0.jpg)](https://youtu.be/w5qo4VSKXTo)
